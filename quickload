#/usr/bin/python3

from src.MessageRepo import MessageRepo
from src.Config import Config
from src.FilterEngine import FilterEngine
from src.Filter import *
import src.Stat as s
import src.CLI.CLI as cli
import src.TUI as tui
import src.Inline as inline

from src.utils.Encoder import QuickloadEncoder
import json
from sys import argv

# if __name__ == "__main__":
#     Config.init(lang="fr")

#     print(f"Loading user data for user '{Config.USER_DATA["global_name"]}' (id: {Config.USER_ID})")
#     repo = MessageRepo(Config.MESSAGES)
#     data = repo.get_messages()
#     engine = FilterEngine(data)
#     env: s.SourceEnvironment = {}

#     # Combine filters to get what you want
#     env["default"] = data
#     a = s.Parser("the total number of messages").parse()
#     print(a.eval(env))
#     print(s.Parser("The average number of messages per day").parse().eval(env))
#     # open("matching.json", "w").write(json.dumps(engine, cls=QuickloadEncoder, ensure_ascii=False))

if __name__ == "__main__":
    mode = "inline"
    if "--cli" in argv:
        mode = "cli"
    elif "--tui" in argv:
        mode = "tui"
    Config.init(lang="fr", mode=mode)

    if Config.MODE == "cli":
        cli.start()
