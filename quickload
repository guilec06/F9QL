#/usr/bin/env python3

from src.MessageRepo import MessageRepo
from src.Config import Config
from src.FilterEngine import FilterEngine
from src.Filter import *

from src.utils.Encoder import QuickloadEncoder
import json

if __name__ == "__main__":
    Config.init(lang="fr")

    print(f"Loading user data for user '{Config.USER_DATA["global_name"]}' (id: {Config.USER_ID})")
    repo = MessageRepo(Config.MESSAGES)
    data = repo.get_visible()
    engine = FilterEngine(data)

    # Combine filters to get what you want
    engine.filters =\
        Filter(FILTERS.SentAfter, "2025-01-01")\
        & Filter(FILTERS.SentBefore, "2026-01-01")\
        & Filter(FILTERS.IsDM)\
        & Filter(FILTERS.MessageContains, "amongus")
    open("matching.json", "w").write(json.dumps(engine, cls=QuickloadEncoder))
    print(engine)
