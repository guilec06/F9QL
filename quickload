#/usr/bin/env python3

from src.MessageRepo import MessageRepo
from src.Config import Config
from src.FilterEngine import FilterEngine
from src.Filter import *

from src.utils.Encoder import QuickloadEncoder
import json

if __name__ == "__main__":
    Config.init(lang="fr")

    print(f"Loading user data for user '{Config.USER_DATA["global_name"]}' (id: {Config.USER_ID})")
    repo = MessageRepo(Config.MESSAGES)
    data = repo.get_visible()
    engine = FilterEngine(data)
    
    # Combine filters to get what you want
    engine.filters =\
        Filter(FILTERS.After, "2025-01-01")\
        & Filter(FILTERS.Before, "2026-01-01")\
        & (Filter(FILTERS.Recipients, "425954265652002816"))
    open("matching.json", "w").write(json.dumps(engine.get_messages(), cls=QuickloadEncoder))
    print(engine)
